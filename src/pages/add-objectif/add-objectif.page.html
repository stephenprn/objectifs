<ion-header>
  <ion-toolbar>
    <ion-title>
      Ajouter un objectif
    </ion-title>
    <ion-buttons start>
      <button ion-button (click)="dismissModal()">
        <span ion-text color="primary" showWhen="ios">Annuler</span>
        <ion-icon name="md-close" showWhen="android,windows"></ion-icon>
      </button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="noScroll">
  <form [formGroup]="formGroup" validate (ngSubmit)="submit()">
    <ion-card>
      <ion-auto-complete (tap)="checkWarning('title')" [ngClass]="{ 'warning': errorsAfterSubmit.title }"
        [dataProvider]="suggestionsService" [options]="{ placeholder : 'Titre' }" formControlName="title" #autocomplete></ion-auto-complete>

      <button class="timeButton" [style.visibility]="isLaterEmpty ? 'hidden': ''" type="button" (click)="showAddedForLater()"
        ion-button icon-only clear>
        <ion-icon name="time"></ion-icon>
      </button>

      <ion-item class="descriptionField">
        <ion-textarea placeholder="Description" formControlName="description"></ion-textarea>
      </ion-item>

      <ion-item>
        <button text-capitalize class="importanceButton" *ngFor="let imp of importances" [ngStyle]="{ 'color': (imp.selected ? '#33333d' : imp.color), 'background-color': (imp.selected ? imp.color : ''), 'border-color': imp.color }"
          [ngClass]="{ 'button-outline button-outline-md': !imp.selected }" (click)="selectImportance(imp)" type="button"
          color="dark" ion-button round>
          <ion-icon class="importanceIcon" name="{{imp.icon}}"></ion-icon>
          {{imp.title}}
        </button>
      </ion-item>

      <ion-item>
        <ion-label>
          <ion-icon name="calendar" class="iconField"></ion-icon>
          <span class="nameField">Date {{formGroup.get('periodicity').value !== 'punctual' ? 'de début': ''}}</span>
        </ion-label>
        <ion-datetime formControlName="date" displayFormat="DD/MM/YYYY" pickerFormat="DD MM YYYY"></ion-datetime>
      </ion-item>
      <!-- <div class="errorMsg animated fadeInDown faster" *ngIf="formGroup.controls['date'].invalid && (formGroup.controls['date'].dirty || submitAttempted)">
                Date requise
            </div> -->

      <ion-item>
        <ion-label>
          <ion-icon name="trophy" class="iconField"></ion-icon>
          <span class="nameField">Categorie</span>
        </ion-label>
        <ion-select formControlName="category">
          <ion-option [value]="category.id" *ngFor="let category of categories">
            {{category.title}}
          </ion-option>
        </ion-select>
      </ion-item>

      <ion-item *ngIf="formGroup.controls['category'].value === 'other'">
        <ion-input class="simpleInput" type="text" placeholder="Autre" formControlName="customCategory" clearInput></ion-input>
      </ion-item>

      <ion-item>
        <ion-label>
          <ion-icon name="sync" class="iconField"></ion-icon>
          <span class="nameField">Répéter</span>
        </ion-label>
        <ion-select formControlName="periodicity">
          <ion-option [value]="periodicity.id" *ngFor="let periodicity of periodicities">
            {{periodicity.title}}
          </ion-option>
        </ion-select>
      </ion-item>

      <ion-item *ngIf="formGroup.get('periodicity').value !== 'punctual'">
        <ion-label>
          <ion-icon name="sync" class="iconField inivisible"></ion-icon>
          Jusqu'à
        </ion-label>
        <ion-datetime formControlName="dateEndPeriodicity" displayFormat="DD/MM/YYYY" pickerFormat="DD MM YYYY"></ion-datetime>
      </ion-item>

      <button type="button" class="periodicityCustomButton" *ngIf="formGroup.get('periodicity').value === 'custom'"
        (click)="openPeriodicity()" ion-button outline>{{periodicityCustom.text}}</button>

      <ion-item *ngIf="formGroup.get('periodicity').value === 'customDays'">
        <button class="dayButton" *ngFor="let periodicity of periodicitiesCustomDays" [ngClass]="{ 'button-outline button-outline-md': !periodicity.selected }"
          (click)="selectPeriodicityCustomDays(periodicity)" type="button" ion-button round>{{periodicity.title}}</button>
      </ion-item>

      <ion-item>
        <ion-label>
          <ion-icon name="stopwatch" class="iconField"></ion-icon>
          <span class="nameField">Peut être reporté</span>
        </ion-label>
        <ion-toggle checked="true" formControlName="reportable"></ion-toggle>
      </ion-item>

      <ion-item>
        <button type="submit" ion-button clear item-end>Valider</button>
      </ion-item>
    </ion-card>
  </form>
</ion-content>
